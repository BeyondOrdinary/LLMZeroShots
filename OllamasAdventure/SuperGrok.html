<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama's Adventure</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #87CEEB;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
<script>
let player, obstacles, clouds, hills, score, highScore, gameSpeed, gameState, retryButton;
let jumpSound, hitSound, bgMusic;

function preload() {
    // Load funny sound effects
    jumpSound = loadSound('https://www.soundjay.com/buttons/sounds/button-09.mp3');
    hitSound = loadSound('https://www.soundjay.com/human/sounds/cartoon-scream-01.mp3');
    bgMusic = loadSound('https://www.soundjay.com/background/sounds/happy-background-music.mp3');
}

function setup() {
    createCanvas(800, 400);
    resetGame();
    highScore = 0;
    // Play background music in a loop
    bgMusic.loop();
    bgMusic.setVolume(0.2);
    // Create retry button, initially hidden
    retryButton = createButton('Retry');
    retryButton.position(width / 2 - 40, height / 2 + 20);
    retryButton.mousePressed(restartGame);
    retryButton.hide();
}

function resetGame() {
    player = new Player();
    obstacles = [];
    clouds = [];
    hills = [];
    score = 0;
    gameSpeed = 5;
    gameState = 'playing';
    // Initialize parallax backgrounds
    for (let i = 0; i < 3; i++) {
        clouds.push(new Cloud(i * width));
        hills.push(new Hill(i * width));
    }
}

function draw() {
    // Parallax scrolling backgrounds
    background(135, 206, 235); // Sky blue
    for (let hill of hills) {
        hill.update();
        hill.show();
    }
    for (let cloud of clouds) {
        cloud.update();
        cloud.show();
    }

    // Game logic
    if (gameState === 'playing') {
        // Update game speed
        gameSpeed += 0.005;
        score += 0.1;

        // Spawn obstacles
        if (frameCount % 60 === 0) {
            obstacles.push(new Obstacle());
        }

        // Update and show obstacles
        for (let i = obstacles.length - 1; i >= 0; i--) {
            obstacles[i].update();
            obstacles[i].show();
            if (obstacles[i].offscreen()) {
                obstacles.splice(i, 1);
            } else if (obstacles[i].hits(player)) {
                hitSound.play();
                gameState = 'gameover';
                retryButton.show();
                if (score > highScore) {
                    highScore = score;
                }
            }
        }

        // Update and show player
        player.update();
        player.show();
    }

    // Display score and high score
    textSize(20);
    fill(0);
    textAlign(LEFT);
    text(`Score: ${floor(score)}`, 20, 30);
    text(`High Score: ${floor(highScore)}`, 20, 60);

    // Game over screen
    if (gameState === 'gameover') {
        textSize(32);
        fill(255, 0, 0);
        textAlign(CENTER);
        text('Game Over!', width / 2, height / 2 - 20);
    }
}

// Player class (cartoonish alpaca)
class Player {
    constructor() {
        this.y = height - 60;
        this.x = 100;
        this.velocity = 0;
        this.gravity = 0.8;
        this.lift = -15;
        this.size = 40;
    }

    show() {
        fill(255, 240, 200); // Light cream fur
        stroke(0);
        strokeWeight(2);
        // Alpaca body
        ellipse(this.x, this.y, this.size, this.size * 0.8);
        // Head
        ellipse(this.x - 10, this.y - 20, this.size * 0.6, this.size * 0.5);
        // Ears
        triangle(this.x - 15, this.y - 30, this.x - 10, this.y - 40, this.x - 5, this.y - 30);
        triangle(this.x - 5, this.y - 30, this.x, this.y - 40, this.x + 5, this.y - 30);
        // Eyes
        fill(0);
        ellipse(this.x - 15, this.y - 20, 5, 5);
        ellipse(this.x - 5, this.y - 20, 5, 5);
        // Legs
        strokeWeight(4);
        line(this.x - 10, this.y + 10, this.x - 10, this.y + 20);
        line(this.x + 10, this.y + 10, this.x + 10, this.y + 20);
    }

    update() {
        this.velocity += this.gravity;
        this.y += this.velocity;
        if (this.y > height - 60) {
            this.y = height - 60;
            this.velocity = 0;
        }
        if (this.y < 0) {
            this.y = 0;
            this.velocity = 0;
        }
    }

    jump() {
        if (this.y === height - 60) {
            this.velocity = this.lift;
            jumpSound.play();
        }
    }
}

// Obstacle class (cactus)
class Obstacle {
    constructor() {
        this.x = width;
        this.y = height - 40;
        this.width = 20;
        this.height = 40;
    }

    show() {
        fill(0, 128, 0); // Green cactus
        noStroke();
        rect(this.x, this.y, this.width, this.height);
        // Cactus arms
        rect(this.x - 10, this.y - 10, 10, 20);
        rect(this.x + 20, this.y - 10, 10, 20);
    }

    update() {
        this.x -= gameSpeed;
    }

    offscreen() {
        return this.x < -this.width;
    }

    hits(player) {
        let d = dist(this.x + this.width / 2, this.y, player.x, player.y);
        return d < (this.width + player.size) / 2;
    }
}

// Cloud class for parallax background
class Cloud {
    constructor(x) {
        this.x = x;
        this.y = random(50, 150);
        this.speed = 1;
    }

    show() {
        fill(255);
        noStroke();
        ellipse(this.x, this.y, 60, 40);
        ellipse(this.x + 30, this.y, 60, 40);
        ellipse(this.x + 15, this.y - 20, 50, 30);
    }

    update() {
        this.x -= this.speed;
        if (this.x < -100) {
            this.x = width + 100;
            this.y = random(50, 150);
        }
    }
}

// Hill class for parallax background
class Hill {
    constructor(x) {
        this.x = x;
        this.y = height;
        this.speed = 2;
    }

    show() {
        fill(34, 139, 34); // Green hills
        noStroke();
        beginShape();
        vertex(this.x, this.y);
        vertex(this.x + 100, this.y - 100);
        vertex(this.x + 200, this.y);
        endShape(CLOSE);
    }

    update() {
        this.x -= this.speed;
        if (this.x < -200) {
            this.x = width;
        }
    }
}

function keyPressed() {
    if (key === ' ' && gameState === 'playing') {
        player.jump();
    }
}

function mousePressed() {
    if (gameState === 'playing') {
        player.jump();
    }
}

function restartGame() {
    resetGame();
    retryButton.hide();
}
</script>
</body>
</html>